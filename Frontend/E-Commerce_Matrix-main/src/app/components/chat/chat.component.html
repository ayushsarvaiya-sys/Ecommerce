<div class="chat-container">
  <!-- Header -->
  <div class="chat-header">
    <h2>Global Chat</h2>
    <div class="connection-status">
      <span class="status-indicator" [class.connected]="isConnected" [class.disconnected]="!isConnected"></span>
      <span class="status-text">{{ isConnected ? 'Connected' : 'Disconnected' }}</span>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading">
    <p>Connecting to chat...</p>
  </div>

  <!-- Messages Container -->
  <div class="messages-container" #messageContainer *ngIf="!isLoading">
    <p *ngIf="messages.length === 0" class="no-messages">
      No messages yet. Be the first to say hello!
    </p>

    <div *ngFor="let message of messages" 
         class="message-wrapper"
         [class.own-message]="isCurrentUser(message.userId)">
      
      <div class="message-group">
        <!-- Avatar and User Info -->
        <div class="message-header">
          <img *ngIf="message.userProfileImage" 
               [src]="message.userProfileImage" 
               [alt]="message.userName"
               class="user-avatar">
          <div *ngIf="!message.userProfileImage" class="user-avatar-placeholder">
            {{ message.userName.charAt(0).toUpperCase() }}
          </div>
          
          <div class="user-info">
            <span class="username">{{ message.userName }}</span>
            <span class="timestamp">{{ formatTime(message.timestamp) }}</span>
          </div>
        </div>

        <!-- Message Content -->
        <div class="message-content">
          <p>{{ message.message }}</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Input Area -->
  <div class="input-container">
    <div class="current-user-info">
      <span class="user-label">Chatting as: <strong>{{ currentUser.name }}</strong></span>
    </div>
    
    <div class="input-group">
      <textarea 
        [(ngModel)]="newMessage"
        (keypress)="onKeyPress($event)"
        placeholder="Type your message here... (Press Enter to send, Shift+Enter for new line)"
        class="message-input"
        [disabled]="!isConnected"
        rows="2"></textarea>
      
      <button 
        (click)="sendMessage()"
        [disabled]="!isConnected || !newMessage.trim()"
        class="send-button">
        <span>Send</span>
      </button>
    </div>

    <div *ngIf="!isConnected" class="connection-warning">
      ⚠️ Not connected to chat. Please refresh the page.
    </div>
  </div>
</div>
